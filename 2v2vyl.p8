pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

function new_player()
	local player =
	{
		num=0; ammo=0; shieldtime=0; hp=0;
		x=0; y=0; vx=2; vy=0; air=false; jumping=false; t=0.0;
	}

	return player
end

k_left=0
k_right=1
k_up=2
k_down=3
k_a=4
k_b=5

val = 0
flag = 0
grav = 0.28
t_step = 0.15
vxmax = 3
maxfall = 4
jumpforce = 4

function solid(x, y)
	val=mget(x/8, y/8)
	flag = fget(val, 1)--0 = terrain flag
	return flag
end

function checkcollision(x,y,w,h)
 return
  solid(x-w,y-h) or
  solid(x+w,y-h) or
  solid(x-w,y+h) or
  solid(x+w,y+h)
end

function update_spx(pl)
	-- direction
	dir = btn(k_right, pl.num) and 1 or (btn(k_left, pl.num) and -1 or 0)

	if dir == 0 then
		if abs(pl.t) < 0.11 then
			pl.t = 0
		end

		if pl.t != 0 then
			if pl.t < 0 then
				pl.t += t_step
			else
				pl.t -= t_step
			end
		end
	end

	if dir == 1 then
		if pl.t < 0 then
			pl.t = pl.t + 0.1
		end
		pl.t = pl.t + 0.05;
		if pl.t > 1 then
			pl.t = 1;
		end
	end

	if dir == -1 then
		if pl.t>0 then
			pl.t = pl.t - 0.1
		end

		pl.t = pl.t - 0.05
		if pl.t < -1 then
			pl.t = -1
		end
	end

	pl.vx = pl.t * vxmax
end

function update_spy(pl)
	--jump
	if btn(k_up,pl.num) and not pl.air and not pl.jumping then
		pl.vy = -jumpforce
		pl.jumping = true
		pl.air = true
	elseif not pl.air and not solid(pl.x, pl.y+9) then
		pl.air = true
	end

	if pl.vy < 0 then -- going upwards
		if (solid(pl.x,pl.y-1)) pl.vy = -pl.vy
	elseif solid(pl.x, pl.y+9) then -- going downwards and landing
		pl.vy = 0
		pl.air = false
		pl.y = flr(pl.y/8)*8
	end

	if pl.air and pl.vy < maxfall then
		pl.vy += grav
	end

	pl.jumping = pl.vy < 0
end

function move(pl)

	update_spx(pl)
	pl.x += pl.vx

	update_spy(pl)
	pl.y += pl.vy
end

function _init()
	p1 = new_player()
	p2 = new_player()
	p3 = new_player()
	p4 = new_player()

	p1.num = 0
	p1.x = 20
	p1.y = 20
end
function _update()
	move(p1)
end
function _draw()
	cls()
	print(p1.t)
	print(p1.vx)
	print(p1.vy)
	print(flag)
	print(val)
	mapdraw(0, 0, 0, 0, 32, 32)
	spr(1,p1.x,p1.y)
end

__gfx__
0000000007ccccc007ccccc007ccccc0666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007ccacacc7ccacacc7ccacacc6777777d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007007ccacacd7ccacacd7ccacacd6766666d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000cccccccdcccccccdcccccccdd6ddddd50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000dccccd00dccccd00dccccd05dddddd50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000dddd0000dddd0000dddd005dddddd50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000d00d0000d00d0000d00d005dddddd50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000d00d0000000d0000d00000555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000b3333300b3333300b333330666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b33a3a33b33a3a33b33a3a33665555555555556600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b33a3a31b33a3a31b33a3a316555e6666666555600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000333333313333333133333331655e76666666655600000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001333310013333100133331065e766666666665600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001111000011110000111100656666666666665600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001001000010010000100100656666666666665600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001001000000010000100000656666666666665600000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007aaaaa007aaaaa007aaaaa0656666666666665600000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007a8a8aaa7a8a8aaa7a8a8aaa656666666666665600000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007a8a8aa97a8a8aa97a8a8aa9656666666666665600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaa9aaaaaaa9aaaaaaa9656666666666665600000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000009aaaa9009aaaa9009aaaa90655666666666665600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009999000099990000999900655566666666555600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009009000090090000900900665555555555556600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009009000000090000900000066666666666666000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000076666600766666007666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000768686667686866676868666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007686866d7686866d7686866d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006666666d6666666d6666666d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000d6666d00d6666d00d6666d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000dddd0000dddd0000dddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000d00d0000d00d0000d00d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000d00d0000000d0000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000006777777d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000006766666d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000d6ddddd50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000005dddddd50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000005dddddd50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000005dddddd50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0004040404040404040404040404040404040404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004060606060600060606060606000006060604000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004060606060006060606060006000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004060606060600000606060006000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000606061500060606060006000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000006060606060606000606000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000000303030000000606000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004040404061313130606060606000004040404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000000004000000000004000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000000406040000000406040000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000060000000000000000000600000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004040404040404040404040404040404040404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
